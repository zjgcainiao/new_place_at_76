{% extends 'homepageapp/10_homepageapp_base.html' %}
{% load crispy_forms_tags %}
{% block content1-main %}

<script>
  $(document).ready(function () {
    $('#validate-address-form').on('submit', function (e) {
      e.preventDefault(); // Prevents the default form submission action

      $.ajax({
        url: "{% url 'core_operations:validate_address_manual' %}", // The URL of your Django view
        type: 'POST',
        contentType: 'application/json',
        data: JSON.stringify({
          address_line_1: $('#address_line_1').val(),
          address_line_2: $('#address_line_2').val(),
          city: $('#city').val(),
          state: $('#state').val(),
          zip_code: $('#zip_code').val()
        }),
        success: function (data) {
          // Clear any previous suggestions
          $('#address-suggestions').empty();

          // Append new suggestions
          if (data.suggestions.length > 0) {
            data.suggestions.forEach(function (suggestion) {
              $('#address-suggestions').append('<li>' + suggestion + '</li>');
            });
          } else {
            $('#address-suggestions').append('<li>No suggestions found.</li>');
          }
        },
        error: function (xhr, status, error) {
          console.error("Error: " + error);
          $('#address-suggestions').empty();
          $('#address-suggestions').append('<li>Error fetching suggestions.</li>');
        }
      });
    });
  });
</script>
<div class="container pt-5 m-5">
  <h2>Validate Addresses VIA GoogleMaps(python)</h2>
  <form id='validate-address-form' method="post">
    {% csrf_token %}
    {% crispy form form.helper %}
    <button type="submit">Validate</button>
  </form>
  <ul id="address-suggestions"></ul>
</div>



<hr>
<script>
  var GOOGLE_MAP_API_KEY = '{{ GOOGLE_MAP_API_KEY }}';
</script>
<script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyBxgqROE2ywDmhTrbEgoUwQyPhZogXU1AU&libraries=places">
</script>

</script>
<script>

  // the following script is create an autocomplete search bar for address based on google maps api

  function initAutocomplete() {
    const input = document.getElementById('addressInput');
    var autocomplete = new google.maps.places.Autocomplete(input);
  }
  google.maps.event.addDomListener(window, 'load', initAutocomplete);

  autocomplete.addListener('place_changed', function () {
    var place = autocomplete.getPlace();
    console.log(place); // Use place details as needed
  });

  function handleAddressSelection() {
    var address = document.getElementById('autocomplete').value;
    // Make an AJAX POST request to your Django backend
    // Include CSRF token if needed
    fetch('/your-backend-endpoint/', {
      method: 'POST',
      body: JSON.stringify({ 'address': address }),
      headers: {
        'Content-Type': 'application/json',
        'X-CSRFToken': csrftoken, // Add CSRF token if required
      }
    })
      .then(response => response.json())
      .then(data => {
        console.log(data); // Handle the response
      })
      .catch(error => console.error('Error:', error));
  }

</script>

<div class="container pt-5 m-5">
  <h2>Validation version 2 </h2>
  <form>
    {% csrf_token %}
    <input id="addressInput" type="text" placeholder="Enter address">
  </form>
  {% endblock %}