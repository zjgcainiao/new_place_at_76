{% load static %}
<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="utf-8">
  <title>Amazing Automan- AI-driven repair shop</title>
  <!-- SEO Meta Tags-->
  <meta name="description"
    content="Tesla &amp; general automotive repair &amp; oil change. AI-driven modern auto repair shop.">
  <meta name="keywords"
    content="oil changes, a/c services, service lights on; radiator problems; detailed vehicle reports;">
  <meta name="author" content="Automan001@76prolubeplus.com">
  <!-- Viewport-->
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <!-- Favicon and Touch Icons-->
  <!-- <link rel="apple-touch-icon" sizes="180x180" href="{% static 'homepageapp/img/apple-touch-icon.png' %}"> -->
  <!-- <link rel="icon" type="image/png" sizes="32x32" href="{% static 'homepageapp/img/favicon-32x32.png' %}"> -->
  <!-- <link rel="icon" type="image/png" sizes="16x16" href="{% static 'homepageapp/img/logo/logo-2022.svg' %}"> -->
  <link rel="manifest" href="{% static 'homepageapp/img/site.webmanifest' %}">
  <link rel="mask-icon" href="{% static 'homepageapp/img/safari-pinned-tab.svg' %}" color="#c2410c">
  <link rel="icon" type="image/x-icon" href="{% static 'homepageapp/img/favicon.ico' %}">
  <link rel="apple-touch-icon" sizes="180x180" href="{% static 'favicon_package_v0/apple-touch-icon.png' %}">
  <link rel="icon" type="image/png" sizes="32x32" href="{% static 'favicon_package_v0/favicon-32x32.png' %}">
  <link rel="icon" type="image/png" sizes="16x16" href="{% static 'favicon_package_v0/favicon-16x16.png' %}">
  <!-- <link rel="icon" type="image/x-icon"  href="{% static 'favicon_package_v0/favicon.ico' %}"> -->
  <!-- <link rel="manifest" href="{% static 'favicon_package_v0/site.webmanifest' %}"> -->
  <!-- <link rel="mask-icon" href="{% static 'favicon_package_v0/safari-pinned-tab.svg' %}" color="#c2410c"> -->
  <meta name="msapplication-TileColor" content="#ffedd5">
  <meta name="theme-color" content="#ffffff">
  <meta name="csrf-token" content="{{ csrf_token }}">
   <!-- this base template include all the necessary css and js files for the this website.  -->
  {% include 'homepageapp/00_the_base.html' %}
</head>



<!-- Page loading styles-->
<style>
  .page-loading {
    position: fixed;
    top: 0;
    right: 0;
    bottom: 0;
    left: 0;
    width: 100%;
    height: 100%;
    -webkit-transition: all .4s .2s ease-in-out;
    transition: all .4s .2s ease-in-out;
    background-color: linear-gradient(160deg, #97989a, #9a9b9d 50%, #c5d0dc 100%);
    /* #1f1b2d; #7c2d12;*/
    opacity: 0;
    visibility: hidden;
    z-index: 99999;
  }

  .page-loading.active {
    opacity: 1;
    visibility: visible;
  }

  .page-loading-inner {
    position: absolute;
    top: 50%;
    left: 0;
    width: 100%;
    text-align: center;
    -webkit-transform: translateY(-50%);
    transform: translateY(-50%);
    -webkit-transition: opacity .2s ease-in-out;
    transition: opacity .2s ease-in-out;
    opacity: 0;
  }

  .page-loading.active>.page-loading-inner {
    opacity: 1;
  }

  .page-loading-inner>span {
    display: block;
    font-size: 1rem;
    font-weight: normal;
    color: #fff;
    ;
  }

  .page-spinner {
    display: inline-block;
    width: 2.75rem;
    height: 2.75rem;
    margin-bottom: .75rem;
    vertical-align: text-bottom;
    border: .15em solid rgb(244, 79, 14);
    border-right-color: transparent;
    border-radius: 50%;
    -webkit-animation: spinner .75s linear infinite;
    animation: spinner .75s linear infinite;
  }

  @-webkit-keyframes spinner {
    100% {
      -webkit-transform: rotate(360deg);
      transform: rotate(360deg);
    }
  }

  @keyframes spinner {
    100% {
      -webkit-transform: rotate(360deg);
      transform: rotate(360deg);
    }
  }

  .navbar-toggle-icon-mdi {
    font-size: 2rem;
    /* Adjust as needed */
    vertical-align: middle;
    /* Center the icon vertically */
  }
</style>

<!-- Page loading scripts-->
<script>

  $(function () {
    // after 2000 mili-seconds, remove the .page-loading element from the view 
    var preloader = $('.page-loading');
    preloader.removeClass('active');
    setTimeout(function () {
      preloader.css('visibility', 'hidden');
      preloader.remove();
    }, 2000);

    // Prevent context menu on specified image selectors
    $(document).on('contextmenu', 'img, .cust-img, .automan-img', function (e) {
      e.preventDefault();
    });
  });
</script>
<!-- Body-->

<body class="bg-light">

  <!-- Page loading spinner-->
  <div class="page-loading active">
    <div class="page-loading-inner">
      <div class="page-spinner"></div><span>Loading...</span>
    </div>
  </div>

  <main class="page-wrapper">
    {% comment %}
    {% include 'homepageapp/12_sign_in_and_sign_up_modal.html' %}
    {% endcomment %}
    <!-- navbar navbar-expand-lg navbar-light bg-light -->
    <header class="navbar navbar-expand-lg fixed-top automan-glossy-metallic" data-scroll-header="">
      <div class="container-fluid">
        <a class="navbar-brand me-3 me-xl-4" href="{% url 'homepageapp:homepage' %}">
          <!-- <img class="d-block" src="{% static '/homepageapp/img/logo/2022-logo-transparent-small.png' %}" width="68" alt="Amazing Automan LLC"></a> -->
          <img class="d-block" src="{% static '/homepageapp/img/logo/2022-logo-transparent-small.png' %}" width="68"
            alt="Amazing Automan LLC" oncontextmenu="return false;">
        </a>
        <!-- toggle button  -->
        <button class="navbar-toggler btn-light ms-auto collapsed" type="button" data-bs-toggle="collapse"
          data-bs-target="#HomepageNavbarNav" aria-controls="navbarNav" aria-expanded="false"
          aria-label="Toggle homepage navigation">
          <span class="mdi mdi-apps navbar-toggle-icon-mdi me-2"></span>
        </button>

        <a class="btn btn-sm btn-outline-light  ms-1 order-lg-3"
          href="{% url 'customer_users:customer_user_register' %}">Register</a>
        <a class="btn btn-outline-light btn-sm ms-1 order-lg-3"
          href="{% url 'customer_users:customer_user_login' %}">Login</a>



        <div class="collapse navbar-collapse order-lg-2" id="HomepageNavbarNav">

          <ul class="navbar-nav navbar-nav-scroll" style="max-height: 35rem;">
            <!-- register and login  -->
            <!-- <li class="nav-item "><a class="nav-link nav-hover" href="{% url 'customer_users:customer_user_register' %}">Register/Login</a></li> -->

            <!-- Appointments  -->
            <li class="nav-item "><a class="nav-link nav-hover"
                href="{% url 'appointments:create_appointment' %}">Service Appointment</a></li>

            <li class="nav-item "><a class="nav-link nav-hover" href="{% url 'shops:search_by_vin_or_plate' %}">VIN
                Report</a></li>
            <li class="nav-item "><a class="nav-link nav-hover"
                href="{% url 'internal_users:internal_user_login' %}">Employee Portal</a></li>
            <!-- More -->
            <li class="nav-item dropdown py-2 me-lg-2">
              <a class="nav-link dropdown-toggle align-items-center  border-light py-1 pe-lg-4" href="#"
                data-bs-toggle="dropdown" role="button" aria-expanded="false"><i
                  class="fi-layers fs-base me-2"></i>More</a>
              <ul class="dropdown-menu dropdown-menu-light">
                <li><a class="dropdown-item fw-normal" href="{% url 'homepageapp:services' %}"><i
                      class="fi-car fs-base me-2"></i>Services</a></li>
                <li class="dropdown-divider"></li>
                <li><a class="dropdown-item" href="{% url 'homepageapp:about-us' %}"><i
                      class="fi-friends fs-base me-2"></i>About Us</a></li>

                <li class="dropdown-divider"></li>
                <li><a class="dropdown-item"
                    href="{% url 'shops:prebuilt_checkout' product_id='prod_PKOol19RtrtGTG' %}"><i
                      class="fi-cash fs-base me-2"></i>Payment</a></li>
                <li class="dropdown-divider"></li>

              </ul>
            </li>
            {% comment %}
            <li class="nav-item"><a class="nav-link nav-hover" href="{% url 'shops:get_online_product_list' %}">Store</a>
            </li>
            <li><a class="dropdown-item" href="{% url 'homepageapp:verify_stripe_applepay' %}"><i
                  class="fi-cash fs-base me-2"></i>Verify Apple Pay</a></li>
            {% endcomment %}

          </ul>
          <!-- Sign In button for mobile -->
          <!-- <div class="text-end">
              <a class="btn btn-primary btn-sm ms-2 ms-lg-3 order-lg-3 d-none d-lg-block" href="{% url 'customer_users:customer_user_register' %}">
                <i class="fi-user-plus me-2"></i>Register/Sign In
              </a>
            </div> -->
        </div>
        <!-- end of navbarNav  -->

      </div>
      <!-- end of container -->
    </header>

    {% block content1-main %}
    This is the main block.
    {% endblock %}
  </main>

  {% comment %}
  {% include 'we_have_ai_helpers/20_chatbot.html' %}
  {% endcomment %}

  <!-- 2023-10-24; style for the fab-icon used in the Chatbot  -->
  <!-- css modifed in 2023-10-28  -->
  <style>
    #loadingMessage {
      font-weight: 900;
      font-family: 'Roboto', sans-serif;
      color: #df6005;
      font-style: italic;
    }

    .card-hover:hover {
      box-shadow: 0 4px 8px rgba(230, 61, 5, 0.2);
    }

    .fab-icon {
      border-radius: 50%;
      /* Makes the button circular */
      width: 55px;
      /* Set width of the button */
      height: 55px;
      /* Set height of the button */
      text-align: center;
      /* Center the robot icon */
      padding: 5px;
      /* remove padding */
      font-size: 24px;
      /* Set icon size */
      box-shadow: 0 2px 10px rgba(130, 205, 10, 0.3);
      /* Optional: Add a little shadow for depth */
      transition: transform 0.3s;
      /* Optional: Smooth transition for hover effect */
      margin-bottom: 100px;
    }

    /* This CSS code block defines the hover effect for the .fab-icon class.
      When the .fab-icon element is hovered over, it will be slightly enlarged by 10%. */

    .fab-icon:hover {
      transform: scale(1.1);
    }

    /* Glossy metallic look for the chatbot window*/
    .glossy-metallic {
      background: linear-gradient(160deg, #97989a, #d1d3d5, #555d61 100%);
      color: #fff;
      border: none;
    }

    #botResponse strong {
      color: #9a3412;
      /* Choose a color that fits your UI for highlighting */
      font-weight: bold;

    }
    #chatbotUI {
        min-width: 300px; /* Minimum width */
        max-width: 90%; /* Don't let it exceed 90% of the screen width */
        width: auto; /* Default width */
    }

    /* Medium screens (Greater than or equal to 768px) */
    @media (min-width: 768px) {
        #chatbotUI {
            min-width: 450px; /* Slightly larger minimum width for medium screens */
          
        }
    }
    #userInput {
      font-weight: bold;
      /* Bolder font */
      font-size: 1rem;
      /* Adjust font size as needed */
      color: #121212;
      /* Light color for text */
      /* background: #393939; Dark background for metallic look */
      background: #e5e7eb;
      border: 1px #313232;
      /* Border color */
      border-radius: 4px;
      /* Rounded corners */
      padding: 8px;
      /* Padding inside the textarea */
    }

    /* Optional: Style for the placeholder text */
    #userInput::placeholder {
      color: #aea9a9;
      font-style: italic;
    }

    #enableChatbot {
      margin-right: 10px !important;
      margin-bottom: 80px !important;
    }

    .confirmation-dialog {
      position: fixed;
      left: 0;
      top: 0;
      max-width: 90%;
      max-height: 90%;
      display: flex;
      align-items: center;
      justify-content: center;
      background: rgba(0, 0, 0, 0.5);
      z-index: 2000;
    }

    
    .shadow-lg {
      box-shadow: 0 0 10px rgba(0, 0, 0, 0.3);
    }

    .conversation-log {
      height: 200px;
      /* Adjust as needed */
      overflow-y: auto;
      /* Adds a scrollbar if the content overflows */
    }

    .automan-support-button {
      position: fixed;
      /* Fixed positioning relative to the viewport */
      right: 5px;
      /* 20px from the right */
      bottom: 10px;
      background: none;
      /* Transparent background */
      border: none;
      /* No border */
      cursor: pointer;
      /* Pointer cursor on hover */
    }

.confirmation-dialog {
    display: none; /* Hidden by default */
    position: fixed; /* Stay in place */
    left: 50%;
    top: 50%;
    transform: translate(-50%, -50%); 
    /* # Center the dialog */
    width: 100%; /* Full width */
    height: 100%; /* Full height */
    background-color: rgba(0, 0, 0, 0.5); /* Black w/ opacity */
    z-index: 2000; /* Sit on top */
    display: flex;
    align-items: center;
    justify-content: center;
}


.dialog-content {
    text-align: center;
    background: #fefefe;
    padding: 5px;
    border-radius: 10px;
    box-shadow: 0 5px 15px rgba(0, 0, 0, 0.3);
    max-width: 95%; /* Don't let it get too wide on large screens */
    width: auto; /* Shrink on small screens */
    margin: 5px; /* Ensure some space around the content */
}

/* Style for the buttons and button-group */

.dialog-content .button-group {
    display: flex;
    flex-direction: row; /* Align buttons in a row */
    justify-content: center; /* Center buttons horizontally */
    align-items: center; /* Center buttons vertically */
    gap: 10px; /* Add space between buttons */
    margin-top: 10px; /* Space between text and buttons */
}

/* Small screens (less than 768px) */
@media (max-width: 767px) {
    .dialog-content .button-group {
        flex-direction: column; /* Stack buttons vertically */
    }
}

.dialog-content button {
    margin: 5px;
    /* width: 150px; Fixed width for all buttons */
    box-shadow: 0 2px 4px rgba(0, 0, 0, 0.2);
    transition: all 0.3s ease; /* Smooth transition */
}

/* Hover effect for buttons */
.dialog-content button:hover {
    transform: translateY(-2px);
    box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
}

/* For the Cancel button, a different hover effect might be suitable */
#cancelDialog:hover {
    background-color: #f44336; /* Slightly darker */
    color: white;
}
.button-group {
  min-width: 150px; /* Adjust as needed */

  display: flex;
  justify-content: center; /* Center buttons horizontally */
  align-items: center; /* Align buttons vertically */
  gap: 10px; /* Spacing between buttons */
  padding: 10px; /* Padding around the button group */
}

/* You can keep the previous button styles */

  </style>

  <!-- added confirmationDiag to integrate the chatbot and customer support window -->
<div id="confirmationDialog" class="confirmation-dialog" style="display: none;">
  <div class="dialog-content p-2 m-2">
    <h4>Welcome!</h4>
    <p class="fw-normal">Please choose your preferred support option:</p>
    <div class="button-group"> <!-- Button group container -->
      <button id="chooseChatbot" class="btn btn-outline-primary">AI Pulido</button>
      <button id="chooseHumanSupport" class="btn btn-outline-secondary">Human Support (soon)</button>
      <button id="cancelDialog" class="btn btn-outline-danger">Cancel</button>
    </div>
  </div>
</div>


  <!-- customer support window ui  -->
  <!-- 2023-11-08 added a customer support converation button  -->

  {% comment %}
  {% include 'customer_users/02_customer_user_support_conversation_ui.html' %}

  <script src="{% static 'CRMs/js/support_conversation.js' %}"></script>
  {% endcomment %}




  <!-- ----------------------------UI for chatbot --------------------------------  -->

  <!-- AI assitant: chatbotUI  -->
  <div id="chatbotUI" class="card card-hover card-lg position-fixed bottom-0 end-0 p-1 m-2  glossy-metallic"
    style="display:none; min-width: 560px; z-index:1000;">
    <div class="card-header" style="background:transparent;">
      <span class="float-end" id="closeChatbot" style="cursor:pointer;">
        <i class="fas fa-times"></i>
      </span>
      <h5 class="card-title fw-bold">Ask Pulido <small>(beta 1.0)</small></h5>
      <p class="fw-bold">Our virtual technican. Automotive questions only. </p>

    </div>
    <!-- assign csrf_token into the card-body  -->
    <form class="card-body  p-1 m-1" id='chatbotCardBody' data-csrf-token="{{ csrf_token }}" method="POST">
      {% csrf_token %}
      <textarea id="userInput" class="form-control" type="text" value=""></textarea>
      <button id="askButton" class="btn btn-dark btn-sm mt-3"><i class=" fi-send fs-base me-2"></i>Send</button>
      <div id="botResponse" class="d-block mt-2 ">
        <div id="loadingMessage" class="text-light" style="display:none;">Hmmm...Let me think...</div>
      </div>
    </form>
  </div>

  <!-- Button to enable chatbot -->
  <button id="enableChatbot"
    class="btn btn-outline-success position-fixed automan-chatbot-toggle-button bottom-0 end-0 m-3 p-1 fab-icon"
    style="z-index: 1030; margin-bottom: 10px; margin-right: 10px;" aria-label="Talk to Virtual Assistant Pulido">
    <img src="{% static 'core_operations/imgs/robot-icon-01-smaller.svg' %}" alt="Robot Icon"
      style="height: 1.5em; width: 1.5em;" />
  </button>

  <!-- added customized css styling  -->
  <!-- <link href="{% static 'core_operations/css/automan-theme.css' %}" rel="stylesheet"> -->
  <div id="loading-spinner-new-conversation" class="automan-spinner-border-new-conversation text-primary" role="status"
    style="display: none;">
    <span class="sr-only">launching a new customer support conversation...please wait...</span>
  </div>

  <form method="POST" id="new-support-conversation-form">
    {% csrf_token %}
    <btn class="automan-support-button" id="new_conversation_button" type="submit" value="Submit">
      <!-- <i class="automan-support-icon fa fa-comments"></i> -->
    </btn>
  </form>

  <!-- the customer support window  -->
  <div class="automan-support-window" id="support_conversation_window">
  </div>



  <script>
    // homepagebase based function to get cookies
    function getCookie(name) {
      let value = "; " + document.cookie;
      let parts = value.split("; " + name + "=");
      if (parts.length === 2) return parts.pop().split(";").shift();
    }

    // another function to get CSRFToken. via meta 
    function getCSRFTokenViaMeta() {
      return document.querySelector('meta[name="csrf-token"]').getAttribute('content');
    }

    function getCSRFTokenViaCardBodyFunc() {
      return document.querySelector('#chatbotCardBody').getAttribute('data-csrf-token');
    }


    // // Function to handle debounce
    // function debounce(func, wait, immediate) {
    //   var timeout;
    //   return function () {
    //     var context = this, args = arguments;
    //     var later = function () {
    //       timeout = null;
    //       if (!immediate) func.apply(context, args);
    //     };
    //     var callNow = immediate && !timeout;
    //     clearTimeout(timeout);
    //     timeout = setTimeout(later, wait);
    //     if (callNow) func.apply(context, args);
    //   };
    // }

    // // function 2 - renderConversationWindow
    // // this function renders a conversation window with new convesation uid. enable wesocket for messaging 
    // function renderConversationWindow(uuid) {

    //   // Determine if the app is running on localhost
    //   // var isLocalhost = ["localhost", "127.0.0.1"].includes(window.location.hostname);
    //   // var wsProtocol = isLocalhost ? "ws://" : "wss://";
    //   var wsProtocol = window.location.protocol === 'https:' ? 'wss://' : 'ws://';
    //   // Creating the HTML structure
    //   var conversationHtml = `  
    //     <div class="card card-hover border-5 p-1 m-1">
    //         <div class="card-header text-dark d-flex justify-content-between align-items-center">
    //             <h4>Customer Support (Beta)</h4>
    //             <button class="btn btn-sm btn-outline-danger" id="end-conversation-button" type="button">&times;</button>
    //         </div>
    //         <p class="text-muted">(Support-Case-ID:${uuid})</p>
    //         <div class="card-body m-1">
    //             <textarea id="conversation-log" class='form-control mb-2 conversation-log' readonly></textarea>
    //             <div class="input-group mb-4">
    //                 <input id="conversation-message-input" type="text" class="form-control" placeholder="Type your message...">
    //                 <div class="input-group-append">
    //                     <button class="btn btn-outline-dark" id="conversation-message-send-button" type="button">Send</button>
    //                 </div>
    //             </div>
                
    //         </div>
    //     </div>
    //   `;

    //   // Append it to the body or a specific element
    //   $('#support_conversation_window').append(conversationHtml);

    //   // Make the support conversation window visible
    //   $('.automan-support-window').fadeIn(1000); // This will smoothly fade in the window

    //   // Establish the WebSocket connection
    //   // use ws:// when its local server. use wss:// for production server.
    //   const conversationSocket = new WebSocket(
    //     wsProtocol + window.location.host + '/ws/conversations/' + uuid + '/'
    //   );

    //   //
    //   conversationSocket.onopen = function (response) {

    //     // You can now safely send a message
    //     // conversationSocket.send(JSON.stringify({ message: 'Hello Server!' }));
    //     // const data = JSON.parse(response.data);
    //     console.info('conversation started...a websocket connection is established...');
    //     localStorage.setItem('activeSupportConversationUUID', uuid);

    //     // document.querySelector('#conversation-log').value += (data.conversation_message + '\n');
    //   };

    //   // WebSocket event for receiving messages
    //   conversationSocket.onmessage = function (response) {
    //     try {
    //       data = JSON.parse(response.data);
    //       const message = data.conversation_message;
    //       let direction = parseInt(0);  // 0 for outgoing, 1 for incoming

    //       let formattedMessage = '';
    //       if (direction === 0) {
    //         formattedMessage = 'Operator: ' + message;
    //       } else {
    //         formattedMessage = 'Customer: ' + message;
    //       }
    //       $('#conversation-log').value += (formattedMessage + '\n');
    //       // $('#conversation-log').val(function(index, value) {
    //       //     return value + (formattedMessage + '\n');
    //       // });
    //     } catch (error) {
    //       console.error('Error Parsing received data. Expecting JSON:', error)
    //     };
    //   };

    //   conversationSocket.onclose = function (e) {
    //     console.log('WebSocket closed:', event);
    //     if (event.wasClean) {
    //       console.log(`Connection closed cleanly, code=${event.code}, reason=${event.reason}`);
    //     } else {
    //       // e.g., the server process killed or network down
    //       console.log('Connection died');
    //     }
    //   };

    //   // Send message event. via clicking 'conversation-message-send-button' button or pressing 'Enter' key
    //   $('#conversation-message-send-button').on('click', function () {
    //     // var messageInput = $('#conversation-message-input');
    //     // var message = messageInput.val();

    //     const messageInputDom = document.querySelector('#conversation-message-input');
    //     const conversation_message = messageInputDom.value;

    //     // Determine the direction of the message
    //     // For example, let's assume 1 is for messages from customer to operator; 0 is from operator to customer.
    //     var messageDirection = 1;

    //     if (conversationSocket.readyState === WebSocket.OPEN) {
    //       conversationSocket.send(JSON.stringify({
    //         'conversation_message': conversation_message,
    //         'message_direction': messageDirection,
    //       }));
    //     } else {
    //       console.error('WebSocket is not open: ' + conversationSocket.readyState);
    //     }

    //     messageInputDom.value = '';

    //   });

    //   // Press Enter to send message
    //   $('#conversation-message-input').keyup(function (e) {
    //     if (e.key === 'Enter' || e.keyCode === 13) {
    //       $('#conversation-message-send-button').click();
    //     }
    //   });
    //   // Focus the input field for message
    //   $('#conversation-message-input').focus();

    //   // End conversation event
    //   $('#end-conversation-button').on('click', function () {
    //     // Perform any cleanup, like closing WebSocket connections
    //     conversationSocket.close();

    //     // Remove the conversation window
    //     $('.automan-support-window').fadeOut(500, function () {
    //       $(this).remove();
    //     });

    //     // Remove the session data
    //     localStorage.removeItem('activeSupportConversationUUID');
    //   });

    // };
    // // end of function renderConversationWindow 

    // // function 3. intiiate an conversation with a human operator.
    // function initiateNewConversation() {
    //   var $button = $('#new_conversation_button');
    //   var $spinner = $('#loading-spinner-new-conversation');
    //   var $form = $('#new-support-conversation-form');
    //   var csrfToken = $form.find('[name=csrfmiddlewaretoken]').val();
    //   $('automan-support-window').show();
    //   // Disable the button and show the spinner
    //   $button.prop('disabled', true);
    //   $spinner.show();

    //   // Clear any existing ajax call timeout
    //   clearTimeout(ajaxCallTimeout);

    //   // Set a new timeout for the AJAX call
    //   ajaxCallTimeout = setTimeout(function () {
    //     console.error('Timeout: Could not get a response from the server.');
    //     $spinner.hide();
    //     $button.prop('disabled', false);
    //   }, ajaxCallDuration);

    //   $.ajax({
    //     url: '/crms/new_conversation/',
    //     type: 'POST',
    //     data: JSON.stringify({}),
    //     contentType: 'application/json',
    //     dataType: 'json',
    //     headers: {
    //       'X-Requested-With': 'XMLHttpRequest',
    //       'X-CSRFToken': csrfToken
    //     },
    //     success: function (data) {
    //       console.log('Fetch data success. Conversation UUID is: ', data.uuid);
    //       if (data.uuid) {
    //         renderConversationWindow(data.uuid);
    //       }
    //     },
    //     error: function (xhr, status, error) {
    //       console.error('Error:', error);
    //     },
    //     complete: function () {
    //       // Clear the ajax call timeout since the call is complete
    //       clearTimeout(ajaxCallTimeout);
    //       $spinner.hide();
    //       $button.prop('disabled', false);
    //     },
    //   });

    // };


    // // handle the case where the user navigates away from the page or closes the browser while a support conversation is active:
    // $(window).on('beforeunload', function () {
    //   // Retrieve the active conversation UUID from localStorage
    //   var activeUUID = localStorage.getItem('activeSupportConversationUUID');

    //   // If there's an active conversation
    //   if (activeUUID) {
    //     // Check if the WebSocket connection is open
    //     if (conversationSocket && conversationSocket.readyState === WebSocket.OPEN) {
    //       // Send a message to the server indicating the user might be leaving
    //       conversationSocket.send(JSON.stringify({
    //         message: 'User might be leaving, hold the conversation.',
    //         uuid: activeUUID
    //       }));
    //     }

    //     // Optionally, you can also clear the active conversation UUID from localStorage
    //     // But this depends on how you want to handle page reloads and revisits
    //     localStorage.removeItem('activeSupportConversationUUID');
    //   }

    // });


    // // jQuery code
    // $(function () {
    //   var debounceTimeout;
    //   var ajaxCallTimeout;
    //   var ajaxCallDuration = 10000; // 10 seconds for timeout
    //   // 2024-01-18 
    //   // added to check if an existing conversation_window with uuid is available in local storage. 
    //   // if yes, render the conversation window using the exsiting conversation uuid.
    //   var existingUUID = localStorage.getItem('activeSupportConversationUUID');
    //   if (existingUUID) {
    //     renderConversationWindow(existingUUID);
    //   }

    //   $('#enableChatbot').on('click', function () {
    //     // Check if the '#confirmationDialog' element exists
    //     if ($('#confirmationDialog').length > 0) {
    //       // If the element exists, fade it in to show the confirmation dialog
    //       $('#confirmationDialog').fadeIn();
    //     } else {
    //       // If the element does not exist, show the chatbot UI directly
    //       $("#chatbotUI").show();
    //       (this).hide();
    //     }
    //   });


    //   // Click event handler for #chooseChatbot button
    //   $('#chooseChatbot').on('click', async function () {
    //     $('#confirmationDialog').fadeOut();
    //     $("#chatbotUI").fadeIn();
    //     $('#enableChatbot').hide();
    //   });


    //   $('#chooseHumanSupport').click(debounce(function (event) {
    //     event.preventDefault();
    //     $('#confirmationDialog').fadeOut();
    //     var $button = $('enableChatBot');
    //     var $spinner = $('#loading-spinner-new-conversation');
    //     var $form = $('#new-support-conversation-form');
    //     var csrfToken = $form.find('[name=csrfmiddlewaretoken]').val();

    //     // Disable the button and show the spinner
    //     $button.prop('disabled', true);
    //     $spinner.show();

    //     // Clear any existing ajax call timeout
    //     clearTimeout(ajaxCallTimeout);

    //     // Set a new timeout for the AJAX call
    //     ajaxCallTimeout = setTimeout(function () {
    //       console.error('Timeout: Could not get a response from the server.');
    //       $spinner.hide();
    //       $button.prop('disabled', false);
    //     }, ajaxCallDuration);

    //     $.ajax({
    //       url: '/crms/new_conversation/',
    //       type: 'POST',
    //       data: JSON.stringify({}),
    //       contentType: 'application/json',
    //       dataType: 'json',
    //       headers: {
    //         'X-Requested-With': 'XMLHttpRequest',
    //         'X-CSRFToken': csrfToken
    //       },
    //       success: function (data) {
    //         console.log('Fetch data success. Conversation UUID is: ', data.uuid);
    //         if (data.uuid) {
    //           renderConversationWindow(data.uuid);
    //         }
    //       },
    //       error: function (xhr, status, error) {
    //         console.error('Error:', error);
    //       },
    //       complete: function () {
    //         // Clear the ajax call timeout since the call is complete
    //         clearTimeout(ajaxCallTimeout);
    //         $spinner.hide();
    //         $button.prop('disabled', false);
    //       },
    //     });

    //   }, 300));


    //   // Click event handler for #cancelDialog button
    //   $('#cancelDialog').on('click', function () {
    //     $('#confirmationDialog').fadeOut();
    //   });

    //   // Close button for the customer support window
    //   $('#closeConversationButton').on('click', function () {
    //     $('.automan-support-window').fadeOut(500, function () {
    //       $(this).remove();
    //     });

    //     $('#enableChatbot').fadeIn(); // Show the enableChatbot button again
    //   });


    //   // option 2 -- interaction with AI assistant
    //     {% comment %}
    //   var chatbotEndpoint = "{% url 'we_have_ai_helpers:chatbot_response' %}";
    //   {% endcomment %}
    //   $("#askButton").on("click", function (e) {
    //     e.preventDefault();
    //     const getCSRFTokenViaCardBody = () => $('#chatbotCardBody').data('csrf-token');
    //     let token = getCSRFTokenViaCardBody();
    //     if (!token) {
    //       console.log("fetching csrfToken with cardBody is not none...try out fetching from meta.");
    //       token = getCSRFTokenViaMeta();
    //     }
    //     if (!token) {

    //       token = getCookie("csrftoken");
    //     }
    //     if (!token) {
    //       console.log("Error - CSRF token not found in the card body or meta tag.");
    //       return;
    //     }
    //     // Disable the "Ask" button to display multiple requests being sent
    //     $(this).prop('disabled', true);

    //     $('#loadingMessage').show();
    //     let userText = $("#userInput").val();

    //     $.ajax({
    //       url: chatbotEndpoint,
    //       type: "POST",
    //       dataType: "json",
    //       data: { "user_input": userText },
    //       headers: {
    //         "X-Requested-With": "XMLHttpRequest",
    //         "X-CSRFToken": getCSRFTokenViaCardBody(), //getCookie("csrftoken")
    //       },
    //       success: function (data) {
    //         console.log("Success - bot response is : ", data.response);
    //         var messageContent = data.response;
    //         // var messageRole = data.response.role; // 'assistant'
    //         let messageRole = 'assistant'

    //         // Format the message
    //         var formattedMessage = `<strong>${messageRole}:</strong> ${messageContent}`;
    //         $("#botResponse").html(formattedMessage);
    //         // $("#botResponse").text(data.response);

    //         // Add a button to opt-in for human operators. 2023-11-17
    //         // var connectHumanButton = $('<button/>', {
    //         //     text: 'Connect with a Human Operator',
    //         //     id: 'connectHumanOperator',
    //         //     class: 'btn btn-primary',
    //         //     click: function() { showHumanOperatorChat(); }
    //         // });

    //         $('#loadingMessage').hide();
    //         $('#askButton').prop('disabled', false);
    //       },
    //       error: function (xhr, status, error) {
    //         console.error("Error - Status: ", status, " Detail: ", error, " XHR: ", xhr);
    //         // Consider providing more descriptive text based on the error status
    //         var errorMsg = "Sorry, there was an error processing your request.";
    //         if (xhr && xhr.responseJSON && xhr.responseJSON.detail) {
    //           errorMsg = xhr.responseJSON.detail;
    //         }
    //         $("#botResponse").text(errorMsg);
    //         $('#loadingMessage').hide();
    //         $('#askButton').prop('disabled', false);
    //       }
    //     });
    //   });
    //   // end of askButton 

    //   $("#closeChatbot").on('click', function () {
    //     $("#chatbotUI").hide();
    //     $("#enableChatbot").fadeIn();  // If you want to show the enable button again
    //   });

    // });


  </script>

  <!-- Footer-->
  {% include 'homepageapp/11_homepageapp_footer.html' %}

</body>
<style>
  .btn-scroll-top {
    position: fixed;
    bottom: 20px;
    right: 20px;
    z-index: 1030; /* Adjust as needed to make it appear above other elements */
}

.btn-scroll-top-tooltip {
    display: none; /* Hide tooltip text by default */
    /* Add more styling as needed */
}

.btn-scroll-top:hover .btn-scroll-top-tooltip {
    display: inline; /* Show tooltip text on hover */
}

</style>
<script>
  // Smooth scroll to top
    $('.btn-scroll-top').on('click', function (e) {
      e.preventDefault();
      $('html, body').animate({ scrollTop: 0 }, '300');
    });

</script>
<!-- Back to top button-->
<a class="btn-scroll-top" href="#top">
  <span class="btn-scroll-top-tooltip text-muted fs-sm me-2">Top</span>
  <i class="btn-scroll-top-icon fi-chevron-up"> </i>
</a>

</html>